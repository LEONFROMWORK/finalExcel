#!/bin/bash
# Railway 환경 변수 처리 스크립트

# 포트 설정
PORT=${PORT:-3000}

# SECRET_KEY_BASE가 없으면 RAILS_MASTER_KEY 사용
if [ -z "$SECRET_KEY_BASE" ] && [ -n "$RAILS_MASTER_KEY" ]; then
  export SECRET_KEY_BASE=$RAILS_MASTER_KEY
fi

# 둘 다 없으면 임시 키 생성 (개발용)
if [ -z "$SECRET_KEY_BASE" ]; then
  export SECRET_KEY_BASE=$(openssl rand -hex 64)
  echo "WARNING: Using temporary SECRET_KEY_BASE"
fi

echo "Starting Rails server on port $PORT..."
exec bundle exec rails server -b 0.0.0.0 -p $PORT